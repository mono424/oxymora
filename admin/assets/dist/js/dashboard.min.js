"use strict";function ContextMenu(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.selector=e,this.items=t,this.magickSelect=a,this.class="contextMenu",this.currentElement=null,this.trigger=null,this.id=(0|9e6*Math.random()).toString(36),console.log(this.id),this.setup=function(){this._setHandler()},this._setHandler=function(){var e=this;$(this.selector).off("contextmenu."+e.id).on("contextmenu."+e.id,a,function(t){t.preventDefault(),t.stopPropagation(),e.trigger=t.currentTarget,e.show(t.pageY+"px",t.pageX+"px")}),$(document).off("click."+e.id).on("click."+e.id,function(t){e.currentElement&&$(t.target).parents("."+this.class).length<=0&&e.hide()})},this.hide=function(){var e=this;e.currentElement.fadeOut(100,function(){e._removeFromDOM()})},this.show=function(e,t){this._addToDom(),this.currentElement.css("top",e),this.currentElement.css("left",t),this.currentElement.fadeIn(100)},this._genHtml=function(){var e=this,a=$("<ul>"),n=$("<div>").addClass(this.class).append(a);return t.forEach(function(t){t.ContextMenu=e,t._contextClickHandler=function(){e.hide()},a.append(t.getElement())}),n},this._addToDom=function(e){this._removeFromDOM(),this.currentElement=this._genHtml(),$("body").append(this.currentElement)},this._removeFromDOM=function(e){$("."+this.class).each(function(){$(this).remove()}),this.currentElement=null},this.setup()}function ContextMenuItem(e,t){var a=this;this.html=e,this.callback=t,this.ContextMenu=null,this.getElement=function(){var t=$("<li>").html(e);return t.on("click",function(e){a._contextClickHandler&&a._contextClickHandler(),a.callback&&a.callback.call(a.ContextMenu.trigger)}),t}}function FileManager(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#fileManager",t=this;this.cutLenght=12,this.element=null,this.url="php/ajax_fileManager.php",this.path=null,this.lastSearch=null,this.searchDelay=500,this.isMoveFile=!1,this.onDirLoaded=null,this.onFileDblClick=null,this.init=function(){t.element=$(e),t.element.on("click",t.fileMangerClickHandler),t.element.on("dragstart",".trash",t.dir_dragStart),t.element.on("dragenter",".trash",t.dir_dragEnter),t.element.on("dragover",".trash",t.dir_dragOver),t.element.on("dragleave",".trash",t.dir_dragLeave),t.element.on("drop",".trash",t.dir_drop),t.element.on("dragstart",".customDir",t.dir_dragStart),t.element.on("dragenter",".customDir",t.dir_dragEnter),t.element.on("dragover",".customDir",t.dir_dragOver),t.element.on("dragleave",".customDir",t.dir_dragLeave),t.element.on("drop",".customDir",t.dir_drop),t.element.on("dragstart",".path a",t.dir_dragStart),t.element.on("dragenter",".path a",t.dir_dragEnter),t.element.on("dragover",".path a",t.dir_dragOver),t.element.on("dragleave",".path a",t.dir_dragLeave),t.element.on("drop",".path a",t.dir_drop),t.element.on("click",".dirs .dir",function(){t.dirClickHandler(this)}),t.element.on("dblclick",".dirs .dir",function(){t.loadDir($(this).data("path"),"")}),t.element.on("dragenter",".files",t.files_dragEnter),t.element.on("dragover",".files",t.files_dragOver),t.element.on("dragleave",".files",t.files_dragLeave),t.element.on("drop",".files",t.files_drop),t.element.on("dragstart",".dirs .dir",t.dir_dragStart),t.element.on("dragenter",".dirs .dir",t.dir_dragEnter),t.element.on("dragover",".dirs .dir",t.dir_dragOver),t.element.on("dragleave",".dirs .dir",t.dir_dragLeave),t.element.on("dragend",".dirs .dir",t.dir_dragEnd),t.element.on("drop",".dirs .dir",t.dir_drop),t.element.on("click",".files .file",function(){t.fileClickHandler(this)}),t.element.on("dblclick",".files .file",function(){t.onFileDblClick&&t.onFileDblClick($(this))}),t.element.on("dragstart",".files .file",t.file_dragStart),t.element.on("dragend",".files .file",t.file_dragEnd),t.element.on("click",".path a",function(e){e.preventDefault(),t.pathClickHandler(this)}),t.element.find(".search input").on("input",function(){t.searchChangeHandler(this)});var a=[new ContextMenuItem("New Folder",function(){var e=t.path,a=lightboxQuestion("New Folder");a+=lightboxInput("name","text","Name"),showLightbox(a,function(a,n){a&&t.createDir(e+"/"+n.name,function(e,t){if(!e)return void notify(NOTIFY_ERROR,t)})},null,"Create","Cancel")})],n=[new ContextMenuItem("Open",function(){t.loadDir($(this).data("path"),"")}),new ContextMenuItem("New Folder",function(){var e=t.path,a=lightboxQuestion("New Folder");a+=lightboxInput("name","text","Name"),showLightbox(a,function(a,n){a&&t.createDir(e+"/"+n.name,function(e,t){if(!e)return void notify(NOTIFY_ERROR,t)})},null,"Create","Cancel")}),new ContextMenuItem("Rename",function(){var e=$(this),a=lightboxQuestion("Rename File");a+=lightboxInput("name","text","Name",e.data("path")),showLightbox(a,function(a,n){a&&t.renameFile(e.data("path"),n.name,function(e,t){if(!e)return void notify(NOTIFY_ERROR,t)})},null,"Rename","Cancel")}),new ContextMenuItem("Delete",function(){var e=$(this).data("path"),a=e.split("/").pop();showLightbox(lightboxQuestion("Delete '"+a+"' ?!"),function(a){a&&t.trashFile(e)},null,"Delete","Cancel")})],i=[new ContextMenuItem("Open",function(){window.open(t.getLink($(this).data("path")),"_blank")}),new ContextMenuItem("Rename",function(){var e=$(this),a=lightboxQuestion("Rename File");a+=lightboxInput("name","text","Name",e.data("path")),showLightbox(a,function(a,n){a&&t.renameFile(e.data("path"),n.name,function(e,t){if(!e)return void notify(NOTIFY_ERROR,t)})},null,"Rename","Cancel")}),new ContextMenuItem("Delete",function(){var e=$(this).data("path"),a=e.split("/").pop();showLightbox(lightboxQuestion("Delete '"+a+"' ?!"),function(a){a&&t.trashFile(e)},null,"Delete","Cancel")})];new ContextMenu(e,a),new ContextMenu(".files",i,".file"),new ContextMenu(".dirs",n,".dir");t.loadDir("","",function(e,t){})},this.loadDir=function(e,a,n){var i=a?"&s="+encodeURIComponent(a):"";t.element.find(".search input").val(a),$.ajax({dataType:"json",url:t.url+"?a=index&dir="+encodeURIComponent(e)+i,success:function(a){a.error?n&&n(!1,a.data):(a.data.dirs.length>0||a.data.files.length>0?(t.addDirsToDOM(a.data.dirs),t.addFilesToDOM(a.data.files)):t.addNothingMessageToDOM(),t.createPathAnchors(e),t.path=e,n&&n(!0,null),t.onDirLoaded&&t.onDirLoaded(!0,null))},error:function(){n&&n(!1,null),t.onDirLoaded&&onDirLoaded(!1,null)}})},this.addDirsToDOM=function(e){var a=t.element.find(".dirs");a.html(""),e.forEach(function(e){a.append(t.htmlDir(e))})},this.addFilesToDOM=function(e){var a=t.element.find(".files");a.html(""),e.forEach(function(e){a.append(t.htmlFile(e)),t.loadPreview(e.fullpath)})},this.addNothingMessageToDOM=function(){t.element.find(".dirs").html(""),t.element.find(".files").html(t.htmlNoFiles())},this.unselectAll=function(){t.element.find(".files .file").each(function(){$(this).removeClass("active")}),t.element.find(".dirs .dir").each(function(){$(this).removeClass("active")})},this.selectItem=function(e){t.unselectAll(),$(e).addClass("active")},this.fileMangerClickHandler=function(e){"dirs"!=e.target.className&&"files"!=e.target.className||t.unselectAll()},this.dirClickHandler=function(e){t.selectItem(e)},this.fileClickHandler=function(e){t.selectItem(e)},this.pathClickHandler=function(e){t.loadDir($(e).data("path"),"",function(e,t){})},this.searchChangeHandler=function(e){var a=$(e).val();t.lastSearch=a,setTimeout(function(){t.lastSearch==a&&t.loadDir(t.path,a,function(e,t){})},t.searchDelay)},this.createPathAnchors=function(e){var a=e.split("/");t.pathAnchorsFromArray(a)},this.pathAnchorsFromArray=function(e){var a=t.element.find(".path ul");a.html('<li><a data-path="" href="#">Meine Dateien</a></li>');var n="";e.forEach(function(e){""!=e&&(n=n?n+"/"+e:e,a.append('><li><a data-path="'+n+'" href="#">'+e+"</a></li>"))})},this.files_dragEnter=function(e){t.element.find(this).addClass("dragover")},this.files_dragOver=function(e){t.eventContainsFiles(e.originalEvent)&&(e.originalEvent.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")},this.files_dragLeave=function(e){t.element.find(this).removeClass("dragover")},this.files_drop=function(e){if(e.originalEvent.preventDefault(),t.element.find(this).removeClass("dragover"),e.originalEvent.dataTransfer.files.length>0)for(var a,n=t.path,i=e.originalEvent.dataTransfer.files,r=0;a=i[r];r++)t.uploadFile(a,n)},this.dir_dragStart=function(e){t.isMoveFile=!0,t.selectItem(this),e.originalEvent.dataTransfer.setDragImage(this,0,0),e.originalEvent.dataTransfer.setData("text/plain",this.dataset.path)},this.dir_dragEnter=function(e){("trash"!==$(this).data("role")&&t.eventContainsFiles(e.originalEvent)||t.isMoveFile)&&t.element.find(this).addClass("dragover")},this.dir_dragOver=function(e){("trash"!==$(this).data("role")&&t.eventContainsFiles(e.originalEvent)||t.isMoveFile)&&(e.originalEvent.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")},this.dir_dragLeave=function(e){t.element.find(this).removeClass("dragover")},this.dir_drop=function(e){var a=this;if(e.originalEvent.preventDefault(),t.element.find(this).removeClass("dragover"),"trash"!==$(this).data("role")&&e.originalEvent.dataTransfer.files.length>0)for(var n,i=this.dataset.path,r=e.originalEvent.dataTransfer.files,o=0;n=r[o];o++)t.uploadFile(n,i);else if(t.isMoveFile){var d;!function(){t.isMoveFile=!1;var n=e.originalEvent.dataTransfer.getData("text");d=n.split("/").pop();var i=a.dataset.path;"trash"===$(a).data("role")?showLightbox(lightboxQuestion("Delete '"+d+"' ?!"),function(e){e&&t.trashFile(n)},null,"Delete","Cancel"):t.moveFile(n,i)}()}},this.dir_dragEnd=function(e){t.isMoveFile=!1},this.file_dragStart=function(e){t.isMoveFile=!0,e.originalEvent.dataTransfer.effectAllowed="copyMove",e.originalEvent.dataTransfer.setData("text/plain",this.dataset.path),t.selectItem(this),e.originalEvent.dataTransfer.setDragImage($(this).find("h3")[0],0,0)},this.file_dragEnd=function(e){t.isMoveFile=!1},this.eventContainsFiles=function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1},this.trashFile=function(e,a){$.ajax({dataType:"json",url:t.url+"?a=moveToTrash&file="+encodeURIComponent(e),success:function(e){console.log(e),e.error?a&&a(!1,e.data):(t.loadDir(t.path,t.lastSearch),a&&a(!0,null))},error:function(){a&&a(!1,null)}})},this.getLink=function(e){var t=window.location.href.split("/");return t.pop(),t.pop(),t.join("/")+"/file"+e},this.renameFile=function(e,a,n){$.ajax({dataType:"json",url:t.url+"?a=rename&file="+encodeURIComponent(e)+"&newfile="+encodeURIComponent(a),success:function(e){e.error?n&&n(!1,e.data):(t.loadDir(t.path,t.lastSearch),n&&n(!0,null))},error:function(){n&&n(!1,null)}})},this.createDir=function(e,a){$.ajax({dataType:"json",url:t.url+"?a=createdir&path="+encodeURIComponent(e),success:function(e){e.error?a&&a(!1,e.data):(t.loadDir(t.path,t.lastSearch),a&&a(!0,null))},error:function(){a&&a(!1,null)}})},this.moveFile=function(e,a,n){$.ajax({dataType:"json",url:t.url+"?a=move&file="+encodeURIComponent(e)+"&output="+encodeURIComponent(a),success:function(e){e.error?n&&n(!1,e.data):(t.loadDir(t.path,t.lastSearch),n&&n(!0,null))},error:function(){n&&n(!1,null)}})},this.uploadFile=function(e,a){var n=new FormData;e&&(n.append("file",e),$.ajax({url:t.url+"?a=uploadFiles&output="+encodeURIComponent(a),type:"POST",data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(e){$("#pageContainer").append(e.data),t.loadDir(t.path),e.error&&e.error.forEach(function(e,t){setTimeout(function(){notify(NOTIFY_ERROR,e)},1.5*t)})},error:function(){notify(NOTIFY_ERROR,"Upload failed! Unknown error!")}}))},this.loadPreview=function(e){var a=t.getFiletype(e);"image"==a?(t.generateFilePreview(e,a),t.loadImagePreview(e)):t.generateFilePreview(e,a)},this.generateFilePreview=function(e,a){var n=t.element.find('*[data-path="'+e+'"] .preview');n[0].width=n.width(),n[0].height=n.height();var i=n[0].getContext("2d");i.save(),i.fillStyle="rgba(241, 75, 59, 0.6)",t.roundRect(i,30,50,n.width()-60,n.height()-100,3,!0,!1),i.font="65px Arial",i.textAlign="center",i.fillStyle="white",i.fillText(a,n.width()/2,n.height()/2+25),i.restore()},this.loadImagePreview=function(e){var a=t.element.find('*[data-path="'+e+'"] .preview'),n=new Image;n.onload=function(){a[0].width=a.width(),a[0].height=a.height();var e=a[0].getContext("2d"),t=(this.width-a.width())*-1/2,n=(this.height-a.height())*-1/2;e.drawImage(this,0,0,a.width(),a.height(),t,n,a.width(),a.height())},n.src=t.url+"?a=preview&file="+encodeURIComponent(e)+"&w="+a.width()+"&h="+a.height()},this.getFiletype=function(e){var t=e.split(".").pop().toLowerCase();switch(t){case"jpeg":case"jpg":case"png":case"gif":case"svg":case"raw":return"image";case"wmv":case"mpg":case"mpeg":case"mp4":case"avi":case"ogg":case"ogv":case"webm":return"video";case"wav":case"aac":case"mp3":case"wma":case"ogg":case"oga":case"flac":return"audio";case"zip":case"rar":case"7zip":return"archive";case"pdf":return"pdf";case"csv":case"xls":case"xlsx":return"excel";case"doc":case"docx":case"xlsx":return"word";case"ppt":case"pptx":return"powerpoint";case"txt":return"text";case"php":case"js":case"html":case"css":case"sql":return"code";default:return"unknown"}},this.getIcon=function(e){switch(e){case"image":return'<i class="fa fa-file-image-o" aria-hidden="true"></i>';case"video":return'<i class="fa fa-file-video-o" aria-hidden="true"></i>';case"audio":return'<i class="fa fa-file-audio-o" aria-hidden="true"></i>';case"archive":return'<i class="fa fa-file-audio-o" aria-hidden="true"></i>';case"pdf":return'<i class="fa fa-file-pdf-o" aria-hidden="true"></i>';case"excel":return'<i class="fa fa-file-excel-o" aria-hidden="true"></i>';case"word":return'<i class="fa fa-file-word-o" aria-hidden="true"></i>';case"powerpoint":return'<i class="fa fa-file-powerpoint-o" aria-hidden="true"></i>';case"text":return'<i class="fa fa-file-text-o" aria-hidden="true"></i>';case"code":return'<i class="fa fa-file-code-o" aria-hidden="true"></i>';default:return'<i class="fa fa-file-o" aria-hidden="true"></i>'}},this.htmlDir=function(e){var t=e.filename.length>this.cutLenght?e.filename.substr(0,this.cutLenght-3)+" ...":e.filename,a='<div draggable="true" data-path="'+e.fullpath+'" class="dir" title="'+e.filename+'"><i class="fa fa-folder" aria-hidden="true"></i></i><h3>'+t+"</h3></div>";return a},this.htmlFile=function(e){var a=t.getFiletype(e.filename),n=t.getIcon(a),i=e.filename.length>this.cutLenght?e.filename.substr(0,this.cutLenght-3)+" ...":e.filename,r='<div draggable="true" data-path="'+e.fullpath+'" class="file" title="'+e.filename+'"><canvas class="preview"></canvas><h3>'+n+" "+i+"</h3></div>";return r},this.htmlNoFiles=function(){var e="<h3>No files uploaded yet.</h3>";return e},this.roundRect=function(e,t,a,n,i,r,o,d){if("undefined"==typeof d&&(d=!0),"undefined"==typeof r&&(r=5),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var l={tl:0,tr:0,br:0,bl:0};for(var s in l)r[s]=r[s]||l[s]}e.beginPath(),e.moveTo(t+r.tl,a),e.lineTo(t+n-r.tr,a),e.quadraticCurveTo(t+n,a,t+n,a+r.tr),e.lineTo(t+n,a+i-r.br),e.quadraticCurveTo(t+n,a+i,t+n-r.br,a+i),e.lineTo(t+r.bl,a+i),e.quadraticCurveTo(t,a+i,t,a+i-r.bl),e.lineTo(t,a+r.tl),e.quadraticCurveTo(t,a,t+r.tl,a),e.closePath(),o&&e.fill(),d&&e.stroke()}}function lightboxQuestion(e){return'<p class="lightboxquestion">'+e+"</p>"}function lightboxInput(e,t,a,n){null==a&&(a=""),null==n&&(n="");return'<input class="lightboxinput" value="'+n+'" placeholder="'+a+'" data-name="'+e+'" type="'+t+'">'}function lightboxCheckbox(e,t,a){a=a?" checked":"";var n='<input class="lightboxinput" data-name="'+e+'" type="checkbox"'+a+">"+t+"<br>";return n}function lightboxSelect(e,t,a){var n='<select class="lightboxinput" data-name="'+e+'">';return null!==a&&(n+='<option value="" selected disabled>'+a+"</option>"),t.forEach(function(e){n+='<option value="'+e.value+'"'+(e.selected===!0?"selected":"")+">"+e.text+"</option>"}),n+="</select>"}function showLightbox(e,t,a,n,i,r){null==n&&(n="Ok"),null==i&&(i="Cancel"),lightboxDialogContent.html(e),lightbox.css("display","block"),lightboxDialog.attr("class","dialog"),null!=r&&lightboxDialog.addClass(r),lightboxDialog.css("margin-top",-lightboxDialog.height()-50),lightboxDialog.css("height",lightboxDialogContent.height()+lightboxOkBtn.height()+30),wrapper.css("filter","blur(5px)"),lightboxDialog.animate({"margin-top":"0"},500,function(){null!=a&&a()}),lightboxOkBtn.unbind(),0==n?lightboxOkBtn.css("display","none"):(lightboxOkBtn.css("display","inline-block"),lightboxOkBtn.text(n),lightboxOkBtn.on("click",function(){var e={length:0};lightboxDialogContent.find(".lightboxinput").each(function(t){var a=$(this),n="";n="file"==a.attr("type")?a[0].files?a[0].files[0]:null:"checkbox"==a.attr("type")?a[0].checked:a.val(),e[a.data("name")]=n,e.length+=1}),lightboxDialogContent.find(".lightboxobject").each(function(t){var a=$(this);e[a.data("name")]=a}),hideLightbox(),null!=t&&t(!0,e)})),lightboxCancelBtn.unbind(),0==i?lightboxCancelBtn.css("display","none"):(lightboxCancelBtn.css("display","inline-block"),lightboxCancelBtn.text(i),lightboxCancelBtn.on("click",function(){hideLightbox(),null!=t&&t(!1,null)}))}function hideLightbox(){lightboxDialog.animate({"margin-top":-lightboxDialog.height()-50},500,function(){wrapper.css("filter","none"),lightbox.css("display","none")})}function notify(e,t,a,n){var i=Math.floor(888888888*Math.random())+111111111;notifyBox[0].dataset.notifyid=i,notifyBox[0].className="notify",n&&(notifyBox[0].className+=" notify-left"),e==NOTIFY_SUCCESS?notifyBox[0].className+=" notify-success":e==NOTIFY_WARNING?notifyBox[0].className+=" notify-warning":e==NOTIFY_ERROR?notifyBox[0].className+=" notify-error":e==NOTIFY_INFO&&(notifyBox[0].className+=" notify-info"),notifyBox[0].innerHTML=t,notifyBox.fadeIn(200),a=a?1e3*a:3e3,setTimeout(function(){notify_destroy(i)},a)}function notify_destroy(e){notifyBox[0].dataset.notifyid==e&&notifyBox.fadeOut(400)}function toggleMenu(e){e=null===e?500:e,menuToggle.toggleClass("open"),menuToggle.hasClass("open")?(isSmallScreen?(sidemenu.css("width",$(window).width()),sidemenu.animate({left:0},e)):(sidemenu.css("width",defaultMenuWidth),sidemenu.animate({left:0},e)),header.animate({width:header.width()-sidemenu.width()},e),wrapper.animate({width:wrapper.outerWidth()-sidemenu.width()},e),lightbox.animate({width:lightbox.outerWidth()-sidemenu.width()},e),menuVisible=!0):(isSmallScreen?(sidemenu.width($(window).width()),sidemenu.animate({left:-$(window).width()},e)):(sidemenu.css("width",defaultMenuWidth),sidemenu.animate({left:-defaultMenuWidth},e)),header.animate({width:header.width()+sidemenu.width()},e),wrapper.animate({width:wrapper.outerWidth()+sidemenu.width()},e),lightbox.animate({width:lightbox.outerWidth()+sidemenu.width()},e),menuVisible=!1)}function calcSize(){var e=isSmallScreen;isSmallScreen=$(window).width()<750,isSmallScreen&&(sidemenu.css("width",$(window).width()),menuVisible||sidemenu.css("left",-sidemenu.width()));var t=menuVisible?sidemenu.position().left+sidemenu.width():0;header.css("width",$(window).width()-t),wrapper.css("height",$(window).height()-header.height()-20),wrapper.css("width",$(window).width()-20-t),wrapper.css("margin-top",header.height()+10),lightbox.css("height",$(window).height()-header.height()),lightbox.css("width",$(window).width()-t),lightbox.css("margin-top",header.height()),tabControlUpdateHeight(),menuVisible&&isSmallScreen&&e===!1&&toggleMenu(0)}function loadPage(e){isSmallScreen&&menuVisible&&toggleMenu(),setPageUrl(e),preloadManager.show(function(){content.load("pages/"+e+".php",function(){preloadManager.hide(function(){}),markNavItem(e,!1),initTabcontrols(".tabContainer")})})}function loadAddonPage(e){isSmallScreen&&menuVisible&&toggleMenu(),setPageUrl("addon-"+e),preloadManager.show(function(){content.load("pages/addon.php?addon="+e,function(){preloadManager.hide(function(){initTabcontrols(".tabContainer")}),markNavItem(e,!0)})})}function setPageUrl(e){var t="/admin/"+e+".html",a="Oxymora | "+ucfirst(e);document.title=a,window.history.pushState({html:$("body").html(),pageTitle:a},"",t)}function markNavItem(e,t){$(".nav").each(function(){!t&&$(this).attr("href")=="#"+e||t&&$(this).attr("href")=="#addon-"+e?$(this).addClass("active"):$(this).removeClass("active")})}function ucfirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}function initTabcontrols(e){$(e+" ul li a").on("click",tabcontrolAnchorClick),$(e).each(function(e){tabcontrolSelectTab($(this),0)})}function tabcontrolAnchorClick(e){tabcontrolSelectTab($(this).parent().parent().parent(),this.dataset.tab)}function tabcontrolSelectTab(e,t){for(var a=e.find("ul li a"),n=0;n<a.length;n++)a[n].dataset.tab===t||n===t?$(a[n]).addClass("active"):$(a[n]).removeClass("active");for(var i=e.find(".tabContent .tab"),n=0;n<i.length;n++)i[n].dataset.tab===t||n===t?(tabControlActiveTab=i[n],$(i[n]).css("opacity","1"),$(i[n]).css("z-index","1"),tabControlUpdateHeight()):($(i[n]).css("opacity","0"),$(i[n]).css("z-index","-1"))}function tabControlUpdateHeight(){$(tabControlActiveTab).parent().css("height",$(tabControlActiveTab).find(".dataContainer").outerHeight()+30)}function spinner(){return'<div class="spinner">\n  <div class="rect1"></div>\n  <div class="rect2"></div>\n  <div class="rect3"></div>\n  <div class="rect4"></div>\n  <div class="rect5"></div>\n</div>'}function initNavItem(){sortNavItems(),setNavItemButtonHandler($(".navitem")),$("#addNavButton").on("click",navItemAddButtonClick)}function setNavItemButtonHandler(e){e.find(".buttonbar button").on("click",navItemButtonClick)}function sortNavItems(){$(".navitem").each(function(e){var t=$(this),a=t.data("display");t.css("top",a*(t.outerHeight()+10))})}function getPrevNavItem(e){var t=!1;return $(".navitem").each(function(a){var n=$(this);e.data("display")-1===n.data("display")&&(t=n)}),t}function getNextNavItem(e){var t=!1;return $(".navitem").each(function(a){var n=$(this);e.data("display")+1===n.data("display")&&(t=n)}),t}function getAllNextNavItem(e){var t=[];return $(".navitem").each(function(a){var n=$(this);e.data("display")<n.data("display")&&t.push(n)}),t}function navItemAddButtonClick(){var e=lightboxInput("title","text","Title","")+lightboxInput("url","text","Url","");showLightbox(e,function(e,t){e&&addNavItem(t.title,t.url)})}function addNavItem(e,t,a){$.get("php/ajax_navigation.php?action=add&title="+encodeURIComponent(e)+"&url="+encodeURIComponent(t),function(e){var e=JSON.parse(e);"success"===e.type&&(html=$(e.message),setNavItemButtonHandler(html),$("#navContainer").append(html),sortNavItems()),checkPageItemInNav(),a&&a(e.type)})}function navItemButtonClick(){var e=$(this),t=e.parent().parent(),a=e.data("action");if("edit"===a){var n=t.find(".title"),i=t.find(".url"),r=lightboxInput("title","text","",n.html())+lightboxInput("url","text","",i.html());showLightbox(r,function(e,a){e&&navDoEdit(t,a.title,a.url)})}else if("remove"===a){var r=lightboxQuestion("Sure you want to delete?");showLightbox(r,function(e,n){e&&navDoRequest(t,a)})}else navDoRequest(t,a)}function navDoRequest(e,t){$.get("php/ajax_navigation.php?id="+e.data("id")+"&action="+t,function(a){var a=JSON.parse(a);if("success"===a.type){if("displayUp"===t){var n=getPrevNavItem(e);e.data("display",e.data("display")-1),n.data("display",n.data("display")+1),sortNavItems()}if("displayDown"===t){var i=getNextNavItem(e);e.data("display",e.data("display")+1),i.data("display",i.data("display")-1),sortNavItems()}if("remove"===t){for(var r=getAllNextNavItem(e),o=0;o<r.length;o++)r[o].data("display",r[o].data("display")-1);e.remove(),checkPageItemInNav(),sortNavItems()}}})}function navDoEdit(e,t,a,n){var i=e.find(".title"),r=e.find(".url");null===t&&(t=i.text()),null===a&&(a=r.text()),$.get("php/ajax_navigation.php?id="+e.data("id")+"&action=edit&title="+encodeURIComponent(t)+"&url="+encodeURIComponent(a),function(e){var e=JSON.parse(e);"success"===e.type&&(i.html(t),r.html(a)),n&&n("success"===e.type)})}function test(){ss.stop()}var buttonManager={loading:function(e,t,a){e.dataset.status="loading",e.dataset.finishedText=a?a:e.innerHTML,e.innerHTML=t?t:"Bitte warten..."},finished:function(e,t,a){e.dataset.status=a?"ready":"finished",e.innerHTML=t?t:e.dataset.finishedText},buttonActiv:function(e,t){return!("loading"==e.dataset.status||!t&&"finished"==e.dataset.status)}},fileSelector={init:function(e,t,a){!function(e,n,i){function r(){if(""!==b.path){var e=b.path.split("/");e.pop(),e=e.join("/"),v[0].dataset.path=e,v.show()}else v.hide()}function o(){b.loadDir(v.data("path"))}function d(e,t){m.fadeIn(200,function(){b.init()})}function l(e){var a=e.data("path"),n=g(a);p.val(a);var i={name:n,path:a};u(n),c(function(){t&&t(i)})}function s(){c(function(){a&&a()})}function c(e){m.fadeOut(400,function(){b.loadDir(""),e&&e()})}function u(e){f.text(e).addClass("isSelected")}function g(e){var t=e.split("/");return t[t.length-1]}var p=$(e);if(!p.hasClass("fileSelector")){p.addClass("fileSelector");var f=$("<button/>").text("Select a File").addClass("fileSelector"),h=$("<div/>").css("position","relative").html(f);p.after(h),f.on("click",function(){d()}),p.hide(),""!==p.val()&&u(g(p.val()));var m=fileSelector._container();f.before(m);var v=m.find(".back").on("click",o),b=(m.find(".close").on("click",s),new FileManager(m));b.onDirLoaded=function(){r()},b.onFileDblClick=function(e){l(e)}}}(e,t,a)},_container:function(e,t){var a=$("<div/>").addClass("fileSelectorBox"),n=$("<header/>");n.append($("<button/>").html('<i class="fa fa-chevron-left" aria-hidden="true"></i>').addClass("back").addClass("customDir")),n.append($("<span/>").text("Select a file ...")),n.append($("<button/>").html('<i class="fa fa-times" aria-hidden="true"></i>').addClass("close"));var i=$("<div/>").addClass("search-container").addClass("search");i.append($("<input/>").attr("placeholder","Search"));var r=$("<div/>").addClass("filesystem-container"),o=$("<div/>").addClass("dirs"),d=$("<div/>").addClass("files");return r.append(o),r.append(d),a.append(n),a.append(i),a.append(r),a},_folder:function(e){var t=$("<div/>").addClass("dir").html('<i class="fa fa-folder" aria-hidden="true"></i><h3>'+e+"</h3>");return t},_file:function(e){var t=$("<div/>").addClass("file").html('\n      <canvas class="preview"></canvas>\n      <footer>\n      <i class="fa fa-file-image-o" aria-hidden="true"></i>\n      <h3>'+e+"</h3>\n      </footer>\n      ");return t}},NOTIFY_SUCCESS=1,NOTIFY_WARNING=2,NOTIFY_ERROR=3,NOTIFY_INFO=4,addonManager={url:"php/ajax_addonManager.php",dragObj:null,dragActive:!1,downloadAddon:function(e,t){var a='<iframe style="display:none;" src="php/downloadAddon.php?addon='+t+'"></iframe>';$("body").append(a)},buttonHandler:function(e,t,a){if(buttonManager.buttonActiv(e,!1)){buttonManager.loading(e);var n=void 0,i=void 0,r=void 0;switch(a){case"install":r=addonManager.installAddon(t,function(t){console.log(t),t.error?(notify(NOTIFY_ERROR,t.data),n="Install",e.dataset.action="install",i=!0):(n="Disable",e.dataset.action="disable",i=!0),buttonManager.finished(e,n,i)});break;case"enable":r=addonManager.enableAddon(t),n="Disable",e.dataset.action="disable",i=!0,buttonManager.finished(e,n,i);break;case"disable":r=addonManager.disableAddon(t),n="Enable",i=!0,e.dataset.action="enable",buttonManager.finished(e,n,i);break;default:r=null,buttonManager.finished(e,n,i)}return r}},installAddon:function(e,t){$.get(addonManager.url+"?a=install&addon="+e,function(e){e=JSON.parse(e),addonMenu.loadMenuItems(),t&&t(e)})},enableAddon:function(e){$.get(addonManager.url+"?a=enable&addon="+e,function(e){e=JSON.parse(e),addonMenu.loadMenuItems()})},disableAddon:function(e){$.get(addonManager.url+"?a=disable&addon="+e,function(e){e=JSON.parse(e),addonMenu.loadMenuItems()})},dragUploadAddon:function(e){if(!$(addonManager.dragObj).hasClass("upload")){$(addonManager.dragObj).addClass("upload");var t=new FormData;e?($.each(e,function(e,a){t.append(e,a)}),$.ajax({url:addonManager.url+"?a=upload",type:"POST",data:t,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){$(addonManager.dragObj).removeClass("upload")},success:function(e){$("#pageContainer").append(e.data),addonMenu.loadMenuItems(),e.error&&e.error.forEach(function(e,t){setTimeout(function(){notify(NOTIFY_ERROR,e)},1.5*t)})},error:function(){notify(NOTIFY_ERROR,"Upload failed! Unknown error!")}})):$(addonManager.dragObj).removeClass("upload")}},fileDragInit:function(e){e.addEventListener("dragover",addonManager.fileDragHover,!1),e.addEventListener("dragleave",addonManager.fileDragHover,!1),e.addEventListener("drop",addonManager.fileSelectHandler,!1),addonManager.dragObj=e},fileDragHover:function(e){e.stopPropagation(),e.preventDefault(),"dragover"==e.type&&0==$(addonManager.dragObj).hasClass("active")?(addonManager.dragActive=!0,$(addonManager.dragObj).addClass("active")):"dragleave"==e.type&&(addonManager.dragActive=!1,setTimeout(function(){0==addonManager.dragActive&&$(addonManager.dragObj).removeClass("active")},500))},fileSelectHandler:function(e){addonManager.fileDragHover(e),$(addonManager.dragObj).removeClass("active");for(var t,a=e.target.files||e.dataTransfer.files,n=0;t=a[n];n++)t.name.endsWith(".oxa")||t.name.endsWith(".zip")?addonManager.dragUploadAddon(a):notify(NOTIFY_ERROR,"Please drop oxymora addons only!")}},dashboard={_widgetContainer:null,dashboardwidgets:null,widgets:null,init:function(e){var t=this;t._widgetContainer=$(e),t._getAllWidgets(function(e,a){return e?(t.widgets=a.map(function(e){return new RootWidget(e)}),void t.updateWidgets(function(){t._updateDOM()})):void alert("Error while loading Widgets!")})},updateWidgets:function(e){var t=this;t._getDashboardWidgets(function(a,n){return a?(t.dashboardwidgets=n.map(function(e){return new Widget(e)}),void(e&&e())):void alert("Error while loading Widgets!")})},addWidget:function(e,t){var a=this;$.get("php/ajax_widgets.php",{action:"add",widget:e},function(e){var n=JSON.parse(e);if(n.error)return void(t&&t(!1,n.data));var i=new Widget(n.data);a.dashboardwidgets.push(i),i.html().insertBefore(a._widgetContainer.find(".widget").last()),t&&t(!0,n.data)})},deleteWidget:function(e,t){var a=this;$.get("php/ajax_widgets.php",{action:"delete",widget:e.id},function(n){var i=JSON.parse(n);return i.error?void(t&&t(!1,i.data)):(a.dashboardwidgets=a.dashboardwidgets.filter(function(t){return t.obj.id!=e.id}),void(t&&t(!0,i.data)))})},moveWidgetUp:function(e,t){$.get("php/ajax_widgets.php",{action:"up",widget:e.id},function(e){var a=JSON.parse(e);return a.error?void(t&&t(!1,a.data)):void(t&&t(!0,a.data))})},moveWidgetDown:function(e,t){$.get("php/ajax_widgets.php",{action:"down",widget:e.id},function(e){var a=JSON.parse(e);return a.error?void(t&&t(!1,a.data)):void(t&&t(!0,a.data))})},_getDashboardWidgets:function(e){$.get("php/ajax_widgets.php",{action:"getDashboard"},function(t){var a=JSON.parse(t);return a.error?void(e&&e(!1,a.data)):void(e&&e(!0,a.data))})},_getAllWidgets:function(e){$.get("php/ajax_widgets.php",{action:"get"},function(t){var a=JSON.parse(t);return a.error?void(e&&e(!1,a.data)):void(e&&e(!0,a.data))})},_updateDOM:function(){var e=this;e._widgetContainer.html(""),e.dashboardwidgets&&e.dashboardwidgets.forEach(function(t){e._widgetContainer.append(t.html())}),e._widgetContainer.append(this._clearAddon())},_clearAddon:function(){var e=this,t=$("<ul/>"),a=$('<li><i class="fa fa-chevron-circle-left" aria-hidden="true"></i><span> Back</span></li>').on("click",function(){$(this).parent().parent().parent().find(".widget-placeholder").fadeIn(200)});t.append(a),e.widgets&&e.widgets.forEach(function(a){var n=a.listHtml().on("click",function(){var t=this;e.addWidget(a.obj.name,function(){$(t).parent().parent().parent().find(".widget-placeholder").fadeIn(200)})});t.append(n)});var n=$('\n      <div class="widget">\n      <div class="widget-placeholder">Click to choose a Widget</div>\n      <div class="widget-select"></div>\n      </div>');return n.find(".widget-select").append(t),n.find(".widget-placeholder").on("click",function(){$(this).fadeOut(200)}),n}},Widget=function(e){
this.obj=e,this.html=function(){var t=$('\n        <div class="widget">\n        <iframe scrolling="no" class="widgetIframe" frameborder="0" src="addon/'+this.obj.widget+'/index.php"></iframe>\n        <a class="delete" href="#">Remove</a>\n        <a class="up" href="#"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>\n        <a class="down" href="#"><i class="fa fa-chevron-down" aria-hidden="true"></i></a>\n        </div>\n        ');return t.find(".up").on("click",function(){var a=t.prev();a.length&&(a.before(t.detach()),dashboard.moveWidgetUp(e,function(e){}))}),t.find(".down").on("click",function(){var a=t.next();a.length&&!$(a[0]).find(".widget-placeholder").length&&(a.after(t.detach()),dashboard.moveWidgetDown(e,function(e){}))}),t.find(".delete").on("click",function(){t.remove(),dashboard.deleteWidget(e,function(e){})}),t}},RootWidget=function(e){this.obj=e,this.listHtml=function(){var e=this.obj.icon?this.obj.iconUrl:"img/coffee.svg";return $('\n          <li>\n          <img src="'+e+'" />\n          <span>'+this.obj.config.menuentry.displayname+"</span>\n          </li>\n          ")}},memberManager={groups:[],init:function(){function e(){$("#addUserButton").on("click",function(){n()}),$("#addGroupButton").on("click",function(){i()}),$("#userContainer").on("click",".user-item .delete",function(){t($(this).parent().parent())}),$("#userContainer").on("click",".user-item .edit",function(){a($(this).parent().parent())}),$("#groupContainer").on("click",".group-item button",function(){var e=$(this).parent().parent(),t=e.data("groupid"),a=$(this).data("action");r(t,a,e)})}function t(e){var t=lightboxQuestion("Delete User");showLightbox(t,function(t,a){t&&memberManager.removeUser(e.data("id"),function(t){t&&e.remove()})},null,"Delete")}function a(e){var t=[];console.log(memberManager.groups),memberManager.groups.forEach(function(a){t.push({value:a.id,text:a.name,selected:a.id==e.data("group")})});var a=lightboxQuestion("Edit User");a+=lightboxInput("username","text","Username",e.data("username")),a+=lightboxInput("email","email","E-Mail",e.data("email")),a+=lightboxInput("image","file","Image"),a+=lightboxInput("password","password","New Password"),a+=lightboxSelect("groupid",t,"Group",e.data("group")),showLightbox(a,function(t,a){t&&memberManager.editUser(e.data("id"),a.username,a.password,a.email,a.image,a.groupid,function(t,a){return t?(e.before(a),void e.remove()):void notify(NOTIFY_ERROR,a)})},null,"Save","Cancel")}function n(){var e=[];console.log(memberManager.groups),memberManager.groups.forEach(function(t){e.push({value:t.id,text:t.name})});var t=lightboxQuestion("Add new User");t+=lightboxInput("username","text","Username"),t+=lightboxInput("email","email","E-Mail"),t+=lightboxInput("image","file","Image"),t+=lightboxInput("password","password","Password"),t+=lightboxSelect("groupid",e,"Group"),showLightbox(t,function(e,t){e&&memberManager.addUser(t.username,t.password,t.email,t.image,t.groupid,function(e,t){return e?void $("#userContainer").append(t):void notify(NOTIFY_ERROR,t)})},null,"Add","Cancel")}function i(){var e=lightboxQuestion("Add new Group");e+=lightboxInput("name","text","Name"),e+=lightboxSelect("color",o,"Color"),showLightbox(e,function(e,t){e&&memberManager.addGroup(t.name,t.color,function(e,t){return e?void $("#groupContainer").append(t):void notify(NOTIFY_ERROR,t)})},null,"Add","Cancel")}function r(e,t,a){!function(){switch(t){case"delete":var n=lightboxQuestion("Delete Group?");showLightbox(n,function(t,a){t&&memberManager.removeGroup(e,function(t,a){return t?void $(".group-item[data-groupid='"+e+"']").remove():void notify(NOTIFY_ERROR,a)})},null,"Delete","Cancel");break;case"premission":var i="",r=null;memberManager.findGroup(e).permissions.filter(function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}),memberManager.findGroup(e).permissions.forEach(function(e){var t=e.key.split("_")[0];t!==r&&(i+=lightboxQuestion(t.ucfirst()),r=t),i+=lightboxCheckbox(e.key,e.title,e.active)}),showLightbox(i,function(t,a){if(t){var n=[];for(key in a)a.hasOwnProperty(key)&&a[key]===!0&&n.push(key);console.log(n),memberManager.groupSavePermission(e,n,function(e){return e.error?void notify(NOTIFY_ERROR,e.data):void memberManager.refreshGroups(function(){notify(NOTIFY_SUCCESS,"Successful saved!")})})}},null,"Save","Cancel");break;case"edit":var d=memberManager.getGroupName(a),l=memberManager.getGroupColor(a),s=o.map(function(e){return e.value==l&&(e.selected=!0),e}),c=lightboxQuestion("Edit Group");c+=lightboxInput("name","text","Name",d),c+=lightboxSelect("color",o,"Color",s),showLightbox(c,function(t,a){t&&memberManager.editGroup(e,a.name,a.color,function(t,n){return t?(memberManager.updateUserColors(e,a.color),void $(".group-item[data-groupid='"+e+"']").after(n).remove()):void notify(NOTIFY_ERROR,n)})},null,"Edit","Cancel")}}()}e();var o=[{value:"rgb(101, 191, 129)",text:"green"},{value:"rgb(237, 165, 43)",text:"orange"},{value:"rgb(226, 93, 161)",text:"purple"},{value:"rgb(77, 186, 193)",text:"blue"},{value:"rgb(191, 127, 80)",text:"brown"}];memberManager.refreshGroups()},updateUserColors:function(e,t){$("#userContainer").find(".user-item[data-group='"+e+"']").each(function(){$(this).find(".info h3").css("background",t)})},addUser:function(e,t,a,n,i,r){var o=new FormData;o.append("a","addMember"),o.append("username",e),o.append("password",t),o.append("email",a),o.append("groupid",i),n&&o.append("image",n),$.ajax({url:"php/ajax_memberManager.php",type:"post",success:function(e){var t=JSON.parse(e);return t.error?void(r&&r(!1,t.data)):void(r&&r(!0,t.data))},error:function(){alert("Something went horribly wrong!")},data:o,mimeTypes:"multipart/form-data",cache:!1,contentType:!1,processData:!1},"json")},editUser:function(e,t,a,n,i,r,o){var d=new FormData;d.append("a","editMember"),d.append("id",e),d.append("username",t),d.append("password",a),d.append("email",n),d.append("groupid",r),i&&d.append("image",i),$.ajax({url:"php/ajax_memberManager.php",type:"post",success:function(e){var t=JSON.parse(e);return t.error?void(o&&o(!1,t.data)):void(o&&o(!0,t.data))},error:function(){alert("Something went horribly wrong!")},data:d,mimeTypes:"multipart/form-data",cache:!1,contentType:!1,processData:!1},"json")},removeUser:function(e,t){$.get("php/ajax_memberManager.php",{a:"removeMember",id:e},function(e){var a=JSON.parse(e);return a.error?void(t&&t(!1,a.data)):void(t&&t(!0,a.data))})},groupSavePermission:function(e,t,a){$.get("php/ajax_memberManager.php",{a:"savePermissions",id:e,permissions:t},function(e){var t=JSON.parse(e);return t.error?void(a&&a(!1,t.data)):void(a&&a(!0,t.data))})},getGroupColor:function(e){return e.find(".info i").css("background-color")},getGroupName:function(e){return e.find(".info span").text()},refreshGroups:function(e){$.get("php/ajax_memberManager.php",{a:"getGroups"},function(t){var a=JSON.parse(t);return a.error?(notify(NOTIFY_ERROR,a.data),void(e&&e(!1))):(memberManager.groups=a.data,void(e&&e(!0)))})},findGroup:function(e){var t=null;return memberManager.groups.forEach(function(a){a.id==e&&(t=a)}),t},addGroup:function(e,t,a){$.get("php/ajax_memberManager.php",{a:"addGroup",name:e,color:t},function(e){var t=JSON.parse(e);return t.error?void(a&&a(!1,t.data)):void memberManager.refreshGroups(function(){a&&a(!0,t.data)})})},removeGroup:function(e,t){$.get("php/ajax_memberManager.php",{a:"removeGroup",id:e},function(e){var a=JSON.parse(e);return a.error?void(t&&t(!1,a.data)):(memberManager.refreshGroups(function(){t&&t(!0,a.data)}),void(t&&t(!0,a.data)))})},editGroup:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;$.get("php/ajax_memberManager.php",{a:"editGroup",id:e,name:t,color:a},function(e){var t=JSON.parse(e);return t.error?void(n&&n(!1,t.data)):(memberManager.refreshGroups(function(){n&&n(!0,t.data)}),void(n&&n(!0,t.data)))})}},pageEditor={currHref:"",pageEditorPreview:"",init:function(){pageEditor.currHref=$(location).attr("href").replace(/[^\/]*$/,""),pageEditor.pageEditorPreview=$("#pageEditorPreview"),pageEditor.pageEditorPreview.on("load",function(){pageEditor.findElements(),pageEditor.addIframeHandler(),pageEditor.page_plugins()})},openWindowPreview:function(){var e=$(".pageGenerator .preview"),t=$(".pageGenerator .menu"),a=$(window.open("","MsgWindow","width=1200,height=800")),n=$(a[0].document.head);n.append("<link rel='stylesheet' href='"+pageEditor.currHref+"css/content.css' type='text/css' media='screen'>");var i=$(a[0].document.body);i.css("overflow","hidden"),i.css("margin",0),i.css("padding",0),i.append(pageEditor.pageEditorPreview),e.fadeOut(200,function(){t.css("transition","ease-in 0.2s"),t.css("width","100%")}),$(a).on("unload",function(){e.append(pageEditor.pageEditorPreview),t.css("transition","ease-in 0.2s"),t.css("width","30%"),setTimeout(function(){e.fadeIn(200)},300)})},save:function(e){pageEditor.findIframeElements();var t=[];$(pageEditor.pageEditorPlugins).each(function(){var e={};e.id=$(this).data("id"),e.plugin=$(this).data("plugin"),e.area=pageEditor.getPluginArea(this),e.settings=pageEditor.getPluginSettings(this),t.push(e)});var a={url:pageEditor.getUrl(),plugins:t};$.ajax({dataType:"json",method:"POST",url:"php/ajax_pageEditor.php?a=save",data:a,success:function(t){t.error?e(!1,t.data):e(!0,null)},error:function(){e(!1,null)}})},page_settings:function(e,t,a,n){var i=null==n?[]:n;pageEditor.pageEditorSidePage.animate({opacity:0},500,function(){var n="";$.post("php/ajax_pageEditor.php?a=pluginSettings",{plugin:encodeURIComponent(e),id:encodeURIComponent(t)},function(e){if(0==e.error){if(!(null!=e.data&&e.data.length>0))return void a(!0,[]);e.data.forEach(function(e){var t=pageEditor.getSettingsValue(i,e.key);n+=pageEditor.addSettingInput(e,t)}),n+='<button class="oxbutton settings-save">Save</button>',n+='<button class="oxbutton settings-cancel">Cancel</button>'}pageEditor.pageEditorSidePage.html(n),pageEditor.page_addSettingHandler(pageEditor.pageEditorSidePage),pageEditor.pageEditorSidePage.find(".addListItem").on("click",function(){var e=$(this).parent(),t=e.data("key"),a=e.data("type"),n=pageEditor.createItemList(t,pageEditor.getItemListNr(e),a),i=$(n).insertBefore($(this));pageEditor.page_addSettingHandler(i)}),pageEditor.pageEditorSidePage.find(".settings-save").on("click",function(){a(!0,pageEditor.getSettingData())}),pageEditor.pageEditorSidePage.find(".settings-cancel").on("click",function(){a(!1,null)}),pageEditor.pageEditorSidePage.animate({opacity:1},500,function(){})},"json")})},page_addSettingHandler:function(e){e.find("input[data-oxytype='bool']").each(function(){$(this).on("change",function(){var e=$(this).prop("checked")?1:0;$(this).val(e)})}),e.find("input[data-oxytype='file']").each(function(){fileSelector.init(this)}),e.find("button.deleteItem").click(function(){this.parentElement.remove()})},page_plugins:function(){pageEditor.pageEditorSidePage.animate({opacity:0},500,function(){var e='<div class="plugins">';$.getJSON("php/ajax_pageEditor.php?a=getPlugins",function(t){0==t.error&&t.data.forEach(function(t){e+='<div data-name="'+t.name+'" draggable="true" class="plugin"><div class="name">'+t.config.displayname+"</div>",1==t.thumb&&(e+='<div class="thumb" style="background-image:url(../'+t.thumbUrl+')">&nbsp;</div>'),e+="</div>"}),e+="</div>",pageEditor.pageEditorSidePage.html(e),pageEditor.addMenuPluginHandler(),pageEditor.pageEditorSidePage.animate({opacity:1},500,function(){})})})},getItemListNr:function(e){for(var t=0,a=e.find(".setting"),n=!1;!n;)n=!0,a.each(function(){t==$(this).data("listitemid")&&(n=!1)}),n||t++;return t},addSettingInput:function(e,t,a,n){t=null==t?"":t,a=null==a?"":a,n=null==n?"":n;var i="[object Array]"===Object.prototype.toString.call(e.type),r=i?" list":"",o='<div class="setting'+r+'" data-listitemid="'+n+'" data-list="'+a+'" data-key="'+e.key+'" data-type="'+(i?JSON.stringify(e.type).escapeHtml():e.type)+'">';if(o+='<h2 class="oxlabel'+r+'">'+e.displayname+"</h2>",o+='<p class="oxdescription'+r+'">'+e.description+"</p>",i){t="[object Array]"===Object.prototype.toString.call(t)?t:[];var d=0;t.forEach(function(t){o+=pageEditor.createItemList(e.key,d++,e.type,t)}),o+='<button class="oxbutton rightBlock addListItem">Add</button>'}else switch(t=$("<div>").text(t).html(),t=t.replace(/["']/g,"&quot;"),e.type){case"textarea":o+='<textarea class="settingbox oxinput">'+t+"</textarea>";break;case"file":o+='<input class="settingbox oxinput" data-oxytype="file" type="text" value="'+t+'"></input>';break;case"bool":o+='<input class="settingbox oxinput" data-oxytype="bool" type="checkbox"'+(1==t?" checked":"")+' value="'+t+'"></input>';break;case"text":default:o+='<input class="settingbox oxinput" type="text" value="'+t+'"></input>'}return o+="</div><br>"},createItemList:function(e,t,a,n){n=n?n:[];var i="";return i+='<div class="itemlist">',i+='<button class="deleteItem"><i class="fa fa-times" aria-hidden="true"></i></button>',a.forEach(function(a){var r=pageEditor.getSettingsValue(n,a.key);i+=pageEditor.addSettingInput(a,r,e,t)}),i+="</div>"},getSettingData:function(){var e=[];return pageEditor.pageEditorSidePage.find(".setting").each(function(t){var a=$(this),n={settingkey:a.data("key"),settingtype:a.data("type"),settingvalue:null};switch(n.settingtype="[object Array]"===Object.prototype.toString.call(n.settingtype)?"list":n.settingtype,a.data("type")){case"textarea":n.settingvalue=a.find(".settingbox").val();break;case"text":default:n.settingvalue=a.find(".settingbox").val()}""!=a.data("list")?e=pageEditor.getSettingDataPushToList(e,a.data("list"),a.data("listitemid"),n):e.push(n)}),e},getSettingDataPushToList:function(e,t,a,n){var i=!1;return e.map(function(e){return e.settingkey===t&&("[object Array]"!==Object.prototype.toString.call(e.settingvalue)&&(e.settingvalue=[]),i=!0),e}),i||e.push({settingkey:t,settingtype:"list",settingvalue:[]}),e.map(function(e){return e.settingkey===t&&(e.settingvalue[a]||(e.settingvalue[a]=[]),e.settingvalue[a].push(n)),e}),e},findElements:function(){pageEditor.findIframeElements(),pageEditor.pageEditorSidePage=lightboxDialog.contents().find(".menu")},pageEditorAreas:null,pageEditorPlugins:null,findIframeElements:function(){pageEditor.pageEditorAreas=pageEditor.pageEditorPreview.contents().find(".oxymora-area"),pageEditor.pageEditorPlugins=pageEditor.pageEditorPreview.contents().find(".oxymora-plugin[data-deleted!=true]")},lastDraggedPlugin:null,addMenuPluginHandler:function(){pageEditor.pageEditorSidePage.find(".plugin").on("dragstart",pageEditor.menu_plugin_dragstartHandler),pageEditor.pageEditorSidePage.find(".plugin").on("dragend",pageEditor.menu_plugin_dragendHandler)},menu_plugin_dragstartHandler:function(){pageEditor.lastDraggedPlugin=$(this),$(this).css("border-color","rgb(255, 0, 168)"),$(this).find(".name").css("color","rgb(255, 140, 240)")},menu_plugin_dragendHandler:function(){$(this).css("border-color","rgb(11, 118, 224)"),$(this).find(".name").css("color","white")},dropTarget:null,dropIsActive:null,addIframeHandler:function(){pageEditor.pageEditorPreview.contents().find("html").on("drop",pageEditor.iframe_dropHandler),pageEditor.pageEditorAreas.each(function(){$(this).on("dragleave",function(e){e.preventDefault(),e.target===this&&pageEditor.iframe_area_dragleaveHandler(this,e)}).on("dragover",function(e){e.preventDefault()}).on("dragenter",function(e){e.preventDefault(),e.target===this&&pageEditor.iframe_area_dragenterHandler(this,e)})}),pageEditor.pageEditorPlugins.each(function(){pageEditor.addPluginHandler($(this))})},iframe_plugin_editHandler:function(){var e=$(this).parent().parent(),t=e.data("id"),a=e.data("plugin"),n=pageEditor.getPluginSettings(e);pageEditor.page_settings(a,t,function(n,i){n?pageEditor.addPluginPreview(a,t,i,e,function(){e.remove(),pageEditor.page_plugins()}):pageEditor.page_plugins()},n)},iframe_plugin_deleteHandler:function(){confirm("Sure you want to delete?")&&pageEditor.deletePlugin($(this).parent().parent())},iframe_plugin_dragoverHandler:function(e,t){pageEditor.isDropMarker()||pageEditor.dropMarker(e)},iframe_plugin_dragenterHandler:function(e,t){pageEditor.dropMarker(e)},iframe_dropHandler:function(e){pageEditor.removeDropMarker();var t=pageEditor.dropTarget;pageEditor.dropTarget=null;var a=pageEditor.lastDraggedPlugin.data("name");pageEditor.page_settings(a,null,function(e,n){e?pageEditor.addPluginPreview(a,"",n,t,function(e,t){console.log("Add Plugin Success:"+e),console.log("Add Plugin Error:"+t),pageEditor.page_plugins()}):pageEditor.page_plugins()})},iframe_dragleaveHandler:function(e,t){pageEditor.removeDropMarker()},iframe_area_dragenterHandler:function(e,t){$(e).addClass("dragOver"),pageEditor.dropMarker(e,!0,!0)},iframe_area_dragleaveHandler:function(e,t){$(e).removeClass("dragOver"),pageEditor.removeDropMarker(),pageEditor.dropTarget=null},getPluginSettings:function(e){return $(e).data("settings")},getPluginArea:function(e){return $(e).parent().data("name")},getSettingsValue:function(e,t){var a=null;return Array.isArray(e)&&e.forEach(function(e,n){e.settingkey===t&&(a=e.settingvalue)}),a},addPluginHandler:function(e){e.find(".oxymora-plugin-edit").on("click",pageEditor.iframe_plugin_editHandler),e.find(".oxymora-plugin-delete").on("click",pageEditor.iframe_plugin_deleteHandler),e.on("dragover",function(e){e.preventDefault(),pageEditor.iframe_plugin_dragoverHandler(this,e)}).on("dragenter",function(t){t.preventDefault(),pageEditor.iframe_plugin_dragenterHandler(e,t)})},addPluginPreview:function(e,t,a,n,i){var r={id:t,plugin:e,settings:a};$.ajax({dataType:"json",method:"POST",url:"php/ajax_pageEditor.php?a=renderPluginPreview",data:r,success:function(e){var t=$(e.data);pageEditor.addPluginHandler(t),n.hasClass("oxymora-area")?(n.prepend(t),i(!0,null)):n.hasClass("oxymora-plugin")?(t.insertAfter(n),i(!0,null)):i(!1,"Invalid Target!")},error:function(){i(!1,null)}})},dropMarker:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];pageEditor.removeDropMarker(),pageEditor.dropTarget=$(e),pageEditor.dropIsActive=!0;var a=' style="display:block;"',n="<div"+a+" class='oxymora-drop-marker'>insert here</div>";null!=t&&0!=t?pageEditor.dropTarget.prepend(n):pageEditor.dropTarget.append(n)},isDropMarker:function(){return pageEditor.dropIsActive},removeDropMarker:function(){pageEditor.pageEditorPreview.contents().find(".oxymora-drop-marker").remove(),pageEditor.dropIsActive=!1},deletePlugin:function(e){e[0].dataset.deleted=!0,e.css("display","none")},getUrl:function(){return $("#pageEditorPreview").data("url")}},sidemenu=$("#sidemenu"),menuToggle=$("#menuToggle"),header=$("#header"),content=$("#content"),preloader=$("#preloader"),wrapper=$("#wrapper"),lightbox=$("#lightbox"),lightboxDialog=$("#lightbox .dialog"),lightboxDialogContent=$("#lightbox .dialog .content"),lightboxCancelBtn=$("#lightbox .dialog .cancel"),lightboxOkBtn=$("#lightbox .dialog .success"),addonTopic=$("#addonTopic"),notifyBox=$("#notify"),defaultMenuWidth=sidemenu.width();notifyBox[0].addEventListener("click",function(){notify_destroy(this.dataset.notifyid)}),String.prototype.htmlEncode=function(){return $("<div/>").text(this).html()},String.prototype.escapeHtml=function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return this.replace(/[&<>"']/g,function(t){return e[t]})},String.prototype.htmlDecode=function(){return $("<div/>").html(this).text()};var menuVisible=!1,isSmallScreen=null,tabControlActiveTab=null,preloadManager={show:function(e){content.fadeOut(200),setTimeout(function(){calcSize(),e&&e()},500)},hide:function(e){e&&e(),content.fadeIn(500),calcSize(),e&&setTimeout(function(){e()},750)}},addonMenu={url:"php/ajax_addonMenu.php",loadMenuItems:function(){$.get(addonMenu.url,function(e){$(".addon-menu").remove(),e=JSON.parse(e),e.data.length>0?(addonMenu.visible(!0),e.data.reverse(),e.data.forEach(function(e){addonTopic.after(addonMenu.createMenuItem(e.name,e.config.menuentry.displayname,e.config.menuentry.menuicon))})):addonMenu.visible(!1)})},visible:function(e){addonTopic.css("display",e?"block":"none")},createMenuItem:function(e,t,a){return'<li class="addon-menu"><a class="nav" onclick="event.preventDefault();loadAddonPage(\''+e+'\')"   href="#"><i class="fa '+a+'" aria-hidden="true"></i> '+t+"</a></li>"}};menuToggle.click(toggleMenu),$(window).resize(function(){calcSize()}),calcSize(),isSmallScreen||toggleMenu(0),"undefined"!=typeof START_PAGE?START_PAGE.startsWith("addon-")?loadAddonPage(START_PAGE.substring("addon-".length)):loadPage(START_PAGE):loadPage("dashboard"),addonMenu.loadMenuItems(),String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");(msie>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(document.getElementById("fallback").style.display="block");